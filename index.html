<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SIAPIS - Sistem Informasi Sekolah</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#eef2ff}
.app{display:flex;height:100vh}
.sidebar{width:260px;background:#1e3a8a;color:white;padding:15px;overflow:auto}
.sidebar h2{margin-top:0}
.menu{cursor:pointer;padding:10px;border-radius:8px;margin-top:5px}
.menu:hover{background:#2563eb}
.submenu{display:none;padding-left:15px}
.submenu div{padding:8px;border-radius:6px;cursor:pointer}
.submenu div:hover{background:#3b82f6}
.content{flex:1;padding:20px;overflow:auto}
.page{display:none;background:white;padding:20px;border-radius:15px}
.active{display:block}
.login{position:fixed;top:0;left:0;width:100%;height:100%;background:#1e3a8a;color:white;display:flex;align-items:center;justify-content:center;flex-direction:column}
button{padding:8px;border:none;border-radius:6px;background:#2563eb;color:white;cursor:pointer;margin-top:5px}
input,select{padding:6px;border-radius:6px;border:1px solid #ccc;margin-top:5px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="login">
<h2>LOGIN SIAPIS</h2>
<select id="role">
<option>Admin</option>
<option>Guru</option>
<option>Operator</option>
</select>
<button onclick="login()">Masuk</button>
</div>

<!-- APP -->
<div id="app" class="app" style="display:none">

<div class="sidebar">
<h2>SIAPIS</h2>

<div class="menu" onclick="showPage('dashboard')">üè† Dashboard</div>

<div class="menu" onclick="toggleMenu('dokumenMenu')">üìÅ Dokumen ‚ñº</div>
<div id="dokumenMenu" class="submenu">
<div onclick="showPage('uploadPage')">‚¨Ü Upload Berkas</div>
<div onclick="showPage('dataPage')">üìÑ Data Berkas</div>
</div>

</div>

<div class="content">

<!-- DASHBOARD -->
<div id="dashboard" class="page active">
<h2>Selamat Datang di SIAPIS</h2>
<p>Sistem Informasi Administrasi Sekolah</p>
</div>

<!-- UPLOAD -->
<div id="uploadPage" class="page">
<h2>Upload Dokumen (PDF / Excel)</h2>
<input type="file" accept=".pdf,.xlsx,.xls" onchange="uploadFile(this)">
<br>
<button onclick="downloadLast()">Download Terakhir</button>
<div id="preview"></div>
</div>

<!-- DATA -->
<div id="dataPage" class="page">
<h2>Data Berkas Terakhir</h2>
<div id="fileInfo">Belum ada file diupload</div>
</div>

</div>
</div>

<script>

const API_SIAPIS="ISI_URL_WEBAPP_ANDA_DISINI";

let role="";
let lastFile=null;

function login(){
role=document.getElementById("role").value;
document.getElementById("login").style.display="none";
document.getElementById("app").style.display="flex";
}

function toggleMenu(id){
let menu=document.getElementById(id);
menu.style.display = menu.style.display==="block" ? "none":"block";
}

function showPage(id){
document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

function uploadFile(input){

const file=input.files[0];
if(!file) return alert("Pilih file dulu");

lastFile=file;

document.getElementById("fileInfo").innerHTML=
"Nama File: "+file.name+"<br>Ukuran: "+(file.size/1024).toFixed(2)+" KB";

if(file.name.endsWith(".xlsx")||file.name.endsWith(".xls")){
readExcel(file);
}else{
document.getElementById("preview").innerHTML=
"<p>File PDF siap diupload.</p>";
}

const reader=new FileReader();

reader.onload=function(e){
const base64=e.target.result.split(",")[1];

fetch(API_SIAPIS,{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({
name:file.name,
type:file.type,
file:base64
})
})
.then(res=>res.text())
.then(()=>alert("‚úÖ Upload berhasil"))
.catch(()=>alert("‚ùå Upload gagal"));
};

reader.readAsDataURL(file);
}

function readExcel(file){
const reader=new FileReader();
reader.onload=function(e){
const data=new Uint8Array(e.target.result);
const workbook=XLSX.read(data,{type:"array"});
const sheet=workbook.Sheets[workbook.SheetNames[0]];
const json=XLSX.utils.sheet_to_json(sheet);

let html="<h3>Preview Excel:</h3><table border='1' cellpadding='5'>";
json.forEach(row=>{
html+="<tr>";
for(let key in row){
html+="<td>"+row[key]+"</td>";
}
html+="</tr>";
});
html+="</table>";

document.getElementById("preview").innerHTML=html;
};
reader.readAsArrayBuffer(file);
}

function downloadLast(){
if(!lastFile) return alert("Belum ada file");
const url=URL.createObjectURL(lastFile);
const a=document.createElement("a");
a.href=url;
a.download=lastFile.name;
a.click();
}

</script>

</body>
</html>
