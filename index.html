<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SIAPIS - Sistem Informasi Sekolah</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#eef2ff}
.app{display:flex;height:100vh}
.sidebar{width:270px;background:#1e3a8a;color:white;overflow:auto;padding:15px}
.sidebar h2{margin-top:0}
.menu{cursor:pointer;padding:10px;border-radius:8px;margin-top:4px}
.menu:hover{background:#2563eb}
.submenu{display:none;padding-left:15px}
.submenu a{display:block;padding:8px;color:white;text-decoration:none;border-radius:6px}
.submenu a:hover{background:#3b82f6}
.content{flex:1;padding:20px;overflow:auto}
.page{display:none;background:white;padding:20px;border-radius:15px}
.active{display:block}
.login{position:fixed;top:0;left:0;width:100%;height:100%;background:#1e3a8a;color:white;display:flex;align-items:center;justify-content:center;flex-direction:column}
button{padding:8px;border:none;border-radius:6px;background:#2563eb;color:white;cursor:pointer;margin-top:5px}
</style>
</head>

<body>

<div id="login" class="login">
<h2>LOGIN SIAPIS</h2>
<select id="role">
<option>Admin</option>
<option>Guru</option>
<option>Operator</option>
</select>
<button onclick="login()">Masuk</button>
</div>

<div id="app" class="app" style="display:none">

<div class="sidebar">
<h2>SIAPIS</h2>
<div class="menu" onclick="showPage('dashboard')">üè† Dasbor</div>
</div>

<div class="content">

<div id="dashboard" class="page active">
<h2>Upload Dokumen SIAPIS</h2>
<input type="file" accept=".pdf,.xlsx,.xls" onchange="uploadFile(this)">
<button onclick="downloadLast()">Download Terakhir</button>
</div>

</div>
</div>

<script>

const API_SIAPIS="https://script.google.com/macros/s/AKfycbz_NbHNgrjsp_dht7PlVQyp0rGejPXt7OdZrK0GoawobaRr5JJa4NwqJfpWYy14gz5q/exec";

let role="";
let lastFile=null;

function showPage(id){
document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

function login(){
role=document.getElementById("role").value;
document.getElementById("login").style.display="none";
document.getElementById("app").style.display="flex";
}

function uploadFile(input){

const file=input.files[0];
if(!file)return alert("Pilih file dulu");

lastFile=file;

if(file.name.endsWith(".xlsx")||file.name.endsWith(".xls")){
readExcel(file);
}

fetch(API_SIAPIS,{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({
nama:file.name,
kelas:"UPLOAD_SIAPIS"
})
})
.then(res=>res.text())
.then(()=>alert("‚úÖ Upload data berhasil ke Spreadsheet"))
.catch(()=>alert("‚ùå Upload gagal"));

}

function readExcel(file){

const reader=new FileReader();

reader.onload=function(e){
const data=new Uint8Array(e.target.result);
const workbook=XLSX.read(data,{type:"array"});
const sheet=workbook.Sheets[workbook.SheetNames[0]];
const json=XLSX.utils.sheet_to_json(sheet);
console.log("DATA EXCEL:",json);
};

reader.readAsArrayBuffer(file);

}

function downloadLast(){
if(!lastFile) return alert("Belum ada file");
const url=URL.createObjectURL(lastFile);
const a=document.createElement("a");
a.href=url;
a.download=lastFile.name;
a.click();
}

</script>

</body>
</html>
